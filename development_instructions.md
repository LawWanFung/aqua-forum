# MERN Stack Aquarium Forum - Development Instructions

## Project Overview

A modern aquarium enthusiast forum platform with user galleries, auto-tagging system, and theme switching capabilities.

---

## Tech Stack

### Frontend

- **React 18** - UI framework with functional components and hooks
- **React Router v6** - Navigation and routing
- **Redux Toolkit** - State management
- **Material-UI v5** - Component library and theming
- **Axios** - HTTP client for API calls
- **React Query/TanStack Query** - Data fetching and caching

### Backend

- **Node.js & Express.js** - Server framework
- **JWT** - Authentication tokens
- **Multer** - File upload handling
- **Mongoose** - MongoDB Object Document Mapper
- **Express-validator** - Input validation middleware
- **Bcrypt** - Password hashing

### Database & Storage

- **MongoDB** - Primary database
- **Cloudinary** or **AWS S3** - Image storage and processing
- **Redis** (Phase 3) - Caching layer for performance

---

## System Architecture

### High-Level Architecture

```
React Frontend â†’ Express API â†’ MongoDB Database
     â†“              â†“              â†“
Material-UI â† Cloudinary SDK â† Redis Cache
     â†“                              â†“
Theme Context                Mongoose Models
```

### Database Collections

1. **users** - User profiles and authentication
2. **posts** - Forum posts and discussions
3. **photos** - User uploaded aquarium photos
4. **comments** - Post comments (embedded in posts)
5. **tags** - Tag definitions and usage statistics

---

## Data Models

### User Schema

```javascript
{
  _id: ObjectId,
  username: String,
  email: String,
  passwordHash: String,
  profile: {
    avatar: String, // Cloudinary URL
    bio: String,
    location: String,
    joinDate: Date,
    preferences: {
      darkMode: Boolean,
      notifications: Boolean
    }
  },
  stats: {
    postCount: Number,
    photoCount: Number,
    followerCount: Number
  }
}
```

### Photo Schema

```javascript
{
  _id: ObjectId,
  userId: ObjectId, // Reference to User
  postId: ObjectId, // Optional: reference to post
  imageUrl: String, // Cloudinary URL
  thumbnailUrl: String,
  title: String,
  description: String,
  aquariumType: String, // "Freshwater", "Saltwater", "Planted"
  tags: [String],
  metadata: {
    uploadedAt: Date,
    likes: Number,
    views: Number
  }
}
```

### Post Schema

```javascript
{
  _id: ObjectId,
  userId: ObjectId,
  title: String,
  content: String,
  tags: [{
    tag: String,
    confidence: Number,
    autoGenerated: Boolean
  }],
  media: [{
    type: String, // "image" | "video"
    url: String
  }],
  metadata: {
    createdAt: Date,
    updatedAt: Date,
    viewCount: Number,
    likeCount: Number,
    commentCount: Number,
    isPinned: Boolean
  },
  engagement: {
    likes: [ObjectId], // User IDs who liked
    bookmarks: [ObjectId] // User IDs who bookmarked
  }
}
```

### Tag Schema

```javascript
{
  _id: ObjectId,
  name: String,
  category: String, // "aquarium-type", "topic", "fish-species"
  usageCount: Number,
  relatedTags: [String]
}
```

---

## API Endpoints

### Authentication

- `POST /api/auth/register` - User registration
- `POST /api/auth/login` - User login
- `POST /api/auth/logout` - User logout
- `GET /api/auth/me` - Get current user

### Users

- `GET /api/users/:userId` - Get user profile
- `PUT /api/users/:userId` - Update user profile
- `GET /api/users/:userId/photos` - Get user's photo gallery
- `GET /api/users/:userId/posts` - Get user's posts

### Posts

- `GET /api/posts` - Get all posts (with pagination, sorting)
- `GET /api/posts?tags=freshwater,saltwater` - Filter by tags
- `GET /api/posts/search?q=query` - Search posts
- `POST /api/posts` - Create new post
- `GET /api/posts/:postId` - Get single post
- `PUT /api/posts/:postId` - Update post
- `DELETE /api/posts/:postId` - Delete post
- `POST /api/posts/:postId/like` - Like post
- `POST /api/posts/:postId/bookmark` - Bookmark post

### Photos

- `POST /api/photos/upload` - Upload photo
- `GET /api/photos/:photoId` - Get photo details
- `PUT /api/photos/:photoId` - Update photo metadata
- `DELETE /api/photos/:photoId` - Delete photo

### Tags

- `GET /api/tags` - Get all tags
- `GET /api/tags/popular` - Get trending tags
- `GET /api/tags/suggestions?q=query` - Get tag suggestions

---

## Frontend Component Structure

### Layout Components

- [`App.js`](src/App.js) - Main application component
- [`Header.js`](src/components/Header.js) - Navigation header with theme toggle
- [`Footer.js`](src/components/Footer.js) - Page footer
- [`MainLayout.js`](src/components/MainLayout.js) - Main layout wrapper

### User Components

- [`UserProfile.js`](src/components/UserProfile.js) - User profile display
- [`UserStats.js`](src/components/UserStats.js) - User statistics
- [`PhotoGallery.js`](src/components/PhotoGallery.js) - Photo grid layout
- [`PhotoUpload.js`](src/components/PhotoUpload.js) - Photo upload interface
- [`PhotoLightbox.js`](src/components/PhotoLightbox.js) - Full-screen photo viewer

### Forum Components

- [`PostFeed.js`](src/components/PostFeed.js) - Main forum feed
- [`PostCard.js`](src/components/PostCard.js) - Individual post display
- [`PostEditor.js`](src/components/PostEditor.js) - Create/edit post
- [`PostDetail.js`](src/components/PostDetail.js) - Post detail view
- [`CommentSection.js`](src/components/CommentSection.js) - Comments display

### Tag Components

- [`TagCloud.js`](src/components/TagCloud.js) - Tag filtering interface
- [`TagSuggestions.js`](src/components/TagSuggestions.js) - Auto-tag suggestions
- [`SearchBar.js`](src/components/SearchBar.js) - Global search

### Theme Components

- [`ThemeToggle.js`](src/components/ThemeToggle.js) - Theme switcher
- [`ThemeProvider.js`](src/contexts/ThemeProvider.js) - Theme context

---

## Implementation Phases

### Phase 1: MVP (Minimum Viable Product)

**Goal: Core functionality with basic features**

#### Backend Tasks

- [ ] Set up Express.js server with basic middleware
- [ ] Configure MongoDB connection with Mongoose
- [ ] Implement User model and authentication (JWT)
- [ ] Create Post model with CRUD endpoints
- [ ] Implement Photo model with Cloudinary integration
- [ ] Set up CORS and environment variables
- [ ] Add basic error handling and validation

#### Frontend Tasks

- [ ] Initialize React app with Vite/Create React App
- [ ] Install and configure Material-UI
- [ ] Set up Redux store with basic structure
- [ ] Create authentication pages (Login/Register)
- [ ] Implement header with navigation
- [ ] Create main dashboard/feed page
- [ ] Build post creation form
- [ ] Implement basic photo upload functionality
- [ ] Create user profile page

#### Testing

- [ ] Test user registration and login
- [ ] Test post creation and display
- [ ] Test photo uploads

---

### Phase 2: Enhanced Features

**Goal: Add auto-tagging and theme switching**

#### Backend Tasks

- [x] Implement auto-tag generation algorithm
- [x] Add confidence scoring to auto-tags
- [ ] Create Tag model and management endpoints
- [x] Integrate Cloudinary AI tagging for images
- [ ] Add search and filtering endpoints
- [ ] Implement bookmark functionality
- [ ] Add view counting and analytics

#### Frontend Tasks

- [x] Implement auto-tag display in posts
- [x] Build tag cloud/filter interface
- [ ] Add search functionality
- [ ] Create theme switching with CSS custom properties
- [ ] Implement dark mode color scheme
- [ ] Save theme preference to user profile
- [ ] Add photo gallery to user profiles
- [ ] Implement lightbox for photo viewing
- [ ] Add bookmark/favorite feature

#### Testing

- [ ] Test auto-tag generation accuracy
- [ ] Test theme persistence
- [ ] Test photo gallery navigation

---

### Phase 3: Advanced Features & Optimization âœ…

**Goal: Performance improvements and advanced functionality** - COMPLETED

#### Backend Tasks âœ…

- [x] Integrate Redis for caching
- [x] Implement real-time notifications
- [x] Add pagination and infinite scroll
- [x] Implement rate limiting
- [ ] Add analytics tracking
- [x] Create admin dashboard
- [ ] Add reported content system

#### Frontend Tasks âœ…

- [x] Implement infinite scroll for posts
- [ ] Add real-time features with WebSockets
- [x] Create admin interface for moderation
- [x] Add photo album organization
- [x] Implement advanced search with filters
- [x] Add user notifications panel
- [x] Optimize image loading with lazy loading
- [ ] Add offline support with service workers

#### Performance âœ…

- [x] Implement code splitting
- [x] Add bundle optimization
- [x] Optimize image sizes and formats
- [x] Add loading states and skeletons

---

### Phase 3 New API Endpoints

#### Notifications

- `GET /api/notifications` - Get user notifications
- `GET /api/notifications/count` - Get unread count
- `PUT /api/notifications/:id/read` - Mark as read
- `PUT /api/notifications/read-all` - Mark all as read
- `DELETE /api/notifications/:id` - Delete notification

#### Admin

- `GET /api/admin/stats` - Dashboard statistics
- `GET /api/admin/users` - Manage users
- `PUT /api/admin/users/:id` - Update user
- `DELETE /api/admin/users/:id` - Delete user
- `GET /api/admin/posts` - Manage posts
- `DELETE /api/admin/posts/:id` - Delete post
- `GET /api/admin/photos` - Manage photos
- `DELETE /api/admin/photos/:id` - Delete photo

#### Albums

- `GET /api/albums` - Get user's albums
- `GET /api/albums/public/:userId` - Get public albums
- `GET /api/albums/:albumId` - Get single album
- `POST /api/albums` - Create album
- `PUT /api/albums/:albumId` - Update album
- `DELETE /api/albums/:albumId` - Delete album
- `POST /api/albums/:albumId/photos/:photoId` - Add photo to album
- `DELETE /api/albums/:albumId/photos/:photoId` - Remove photo from album

---

## Auto-Tagging Algorithm Implementation

### Keyword Dictionary

```javascript
const aquariumKeywords = {
  freshwater: ["freshwater", "tropical", "community tank", "guppy", "tetra"],
  saltwater: ["saltwater", "marine", "reef", "coral", "salt", "ocean"],
  planted: ["planted", "aquascape", "plants", "CO2", "substrate", "hardscape"],
  fish: ["betta", "cichlid", "tetra", "goldfish", "angelfish", "guppy"],
  equipment: ["filter", "heater", "lighting", "pump", "air stone"],
  maintenance: ["water change", "testing", "parameters", "maintenance"],
  disease: ["ich", "parasite", "treatment", "medication", "sick"],
};
```

### Auto-Tag Generation Function

```javascript
function generateTags(postContent, postTitle, imageTags = []) {
  const tags = [];
  const fullText = (postTitle + " " + postContent).toLowerCase();

  // Extract keyword-based tags
  for (const [category, keywords] of Object.entries(aquariumKeywords)) {
    const matches = keywords.filter((keyword) => fullText.includes(keyword));
    if (matches.length >= 2) {
      // Requires at least 2 matches
      tags.push({
        tag: category,
        confidence: Math.min(matches.length * 0.3, 0.9),
        autoGenerated: true,
      });
    }
  }

  // Add image-based tags from Cloudinary AI
  if (imageTags.length > 0) {
    imageTags.forEach((tag) => {
      tags.push({
        tag: tag,
        confidence: 0.85,
        autoGenerated: true,
      });
    });
  }

  return tags;
}
```

---

## Theme Implementation Details

### CSS Variables Setup

```css
/* src/styles/theme.css */
:root {
  --bg-primary: #ffffff;
  --bg-secondary: #f5f5f5;
  --bg-card: #ffffff;
  --text-primary: #333333;
  --text-secondary: #666666;
  --text-muted: #999999;
  --accent-primary: #1976d2;
  --accent-secondary: #42a5f5;
  --border-color: #e0e0e0;
  --shadow-color: rgba(0, 0, 0, 0.1);
  --transition-speed: 0.3s;
}

[data-theme="dark"] {
  --bg-primary: #121212;
  --bg-secondary: #1e1e1e;
  --bg-card: #252525;
  --text-primary: #ffffff;
  --text-secondary: #b0b0b0;
  --text-muted: #808080;
  --accent-primary: #90caf9;
  --accent-secondary: #64b5f6;
  --border-color: #333333;
  --shadow-color: rgba(0, 0, 0, 0.3);
}
```

### React Theme Context

```javascript
// src/contexts/ThemeContext.js
import { createContext, useState, useEffect } from "react";

export const ThemeContext = createContext();

export const ThemeProvider = ({ children }) => {
  const [darkMode, setDarkMode] = useState(() => {
    const saved = localStorage.getItem("darkMode");
    if (saved !== null) return saved === "true";
    return window.matchMedia("(prefers-color-scheme: dark)").matches;
  });

  useEffect(() => {
    localStorage.setItem("darkMode", darkMode);
    document.documentElement.setAttribute(
      "data-theme",
      darkMode ? "dark" : "light",
    );
  }, [darkMode]);

  const toggleDarkMode = () => {
    setDarkMode((prev) => !prev);
  };

  return (
    <ThemeContext.Provider value={{ darkMode, toggleDarkMode }}>
      {children}
    </ThemeContext.Provider>
  );
};
```

---

## Database Indexes

### Essential Indexes for Performance

```javascript
// Posts collection
posts.createIndex({ "metadata.createdAt": -1 });
posts.createIndex({ tags: 1 });
posts.createIndex({ userId: 1 });
posts.createIndex({ "metadata.likeCount": -1 });

// Photos collection
photos.createIndex({ userId: 1, "metadata.uploadedAt": -1 });
photos.createIndex({ tags: 1 });

// Users collection
users.createIndex({ email: 1 }, { unique: true });
users.createIndex({ username: 1 }, { unique: true });

// Tags collection
tags.createIndex({ name: 1 }, { unique: true });
tags.createIndex({ usageCount: -1 });
```

---

## Environment Configuration

### Backend (.env)

```env
NODE_ENV=development
PORT=5000
MONGODB_URI=mongodb://localhost:27017/aqua-forum
JWT_SECRET=your_jwt_secret_key
JWT_EXPIRE=30d

CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret

REDIS_URL=redis://localhost:6379
```

### Frontend (.env)

```env
REACT_APP_API_URL=http://localhost:5000/api
REACT_APP_CLOUDINARY_URL=https://api.cloudinary.com/v1_1/your_cloud_name
```

---

## API Response Format

### Success Response

```json
{
  "success": true,
  "data": {},
  "message": "Operation successful"
}
```

### Error Response

```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "Error description"
  }
}
```

---

## Development Commands

### Backend

```bash
# Install dependencies
npm install

# Run development server
npm run dev

# Run tests
npm test

# Build for production
npm run build
```

### Frontend

```bash
# Install dependencies
npm install

# Run development server
npm start

# Build for production
npm run build

# Run tests
npm test
```

---

## Key Features Summary

### User Profile & Gallery

- **User Profiles**: Customizable profiles with avatar, bio, location
- **Photo Galleries**: Dedicated gallery sections for each user's aquarium photos
- **Photo Upload**: Drag-and-drop interface with Cloudinary integration
- **Lightbox**: Full-screen photo viewing with navigation
- **Statistics**: Post count, photo count, engagement metrics

### Forum & Auto-Tagging

- **Free Discussion**: Open forum without rigid categories
- **Auto-Tag Generation**: AI-powered tagging based on content and images
- **Tag Confidence**: Scoring system for tag accuracy
- **Smart Search**: Full-text search with tag filtering
- **Engagement**: Likes, bookmarks, views tracking
- **Community Learning**: Tags improve based on user additions

### Themes & UI

- **Light/Dark Mode**: Complete theme switching with smooth transitions
- **CSS Variables**: Modern approach to theming with custom properties
- **Material-UI**: Consistent component design system
- **Responsive Design**: Mobile-first approach
- **Accessibility**: WCAG compliant color schemes and keyboard navigation

---

## Future Enhancement Roadmap

### Version 1.1 (2-3 months)

- [ ] Real-time notifications using WebSockets
- [ ] Advanced search with filters
- [ ] Photo albums and organization
- [ ] User following system
- [ ] Comment threading

### Version 1.2 (4-6 months)

- [ ] Push notifications
- [ ] Offline support with service workers
- [ ] Advanced analytics dashboard
- [ ] Content moderation tools
- [ ] Multi-language support

### Version 2.0 (6+ months)

- [ ] Mobile app companion (React Native)
- [ ] Community challenges and contests
- [ ] Marketplace integration
- [ ] Advanced image recognition
- [ ] AI-powered content recommendations
- [ ] Social media integration

---

## Testing Strategy

### Unit Testing

- [ ] Test API endpoints
- [ ] Test React components
- [ ] Test utility functions
- [ ] Test authentication flow

### Integration Testing

- [ ] Test photo upload flow
- [ ] Test post creation to display
- [ ] Test user profile updates
- [ ] Test theme persistence

### E2E Testing

- [ ] User registration and login
- [ ] Complete post creation flow
- [ ] Photo gallery navigation
- [ ] Search and filtering functionality

---

## Performance Targets

- **Page Load Time**: < 2 seconds
- **API Response Time**: < 500ms
- **Image Load Time**: < 1 second (with thumbnails)
- **Database Query Time**: < 100ms
- **Concurrent Users**: 1000+ (with Redis caching)

---

## Security Considerations

### Backend Security

- [ ] Input validation and sanitization
- [ ] Rate limiting on all endpoints
- [ ] JWT token expiration and refresh
- [ ] Secure password hashing with bcrypt
- [ ] CORS configuration
- [ ] Helmet.js for security headers
- [ ] File upload size limits and type validation

### Frontend Security

- [ ] XSS prevention with React
- [ ] CSRF token implementation
- [ ] Secure local storage usage
- [ ] Input sanitization

---

## Deployment Checklist

### Production Ready

- [ ] Environment variables configured
- [ ] Database backups configured
- [ ] SSL certificates installed
- [ ] CDN configured for static assets
- [ ] Monitoring and logging setup
- [ ] Error tracking with Sentry
- [ ] Performance monitoring

---

## Support & Resources

### External Services Setup

- **Cloudinary**: Sign up at https://cloudinary.com
- **MongoDB Atlas**: Cloud database service
- **SendGrid**: Email service for notifications

### Learning Resources

- React Docs: https://react.dev
- Material-UI Docs: https://mui.com
- Express.js Guide: https://expressjs.com
- MongoDB University: https://university.mongodb.com

---

## Contact & Contribution

For questions or contributions, please refer to the project's GitHub repository and follow the contribution guidelines.

**Happy Coding! ðŸ ðŸŸðŸ¦€**
