# çœ‹æ¿åˆ†é¡ç³»çµ±å¯¦ä½œè¨ˆåŠƒ

## æ¦‚è¿°

å°‡ç¾æœ‰çš„è‡ªå‹•æ¨™ç±¤ç³»çµ±æ”¹ç‚ºçœ‹æ¿(Boards)åˆ†é¡ç³»çµ±ï¼š

- çœ‹æ¿ç”¨æ–¼æ–‡ç« åˆ†é¡ï¼ˆä¸€ç¯‡æ–‡ç« å¯å±¬æ–¼å¤šå€‹çœ‹æ¿ï¼‰
- æ¨™ç±¤ä¿ç•™ä½†ç”¨æ–¼æœå°‹ï¼Œæ”¯æ´è‡ªå‹•å®ŒæˆåŠŸèƒ½
- ç§»é™¤è‡ªå‹•æ¨™ç±¤ç”ŸæˆåŠŸèƒ½
- ç®¡ç†å“¡å¯åœ¨å¾Œå°ç®¡ç†çœ‹æ¿

## ç³»çµ±æ¶æ§‹

```mermaid
erDiagram
    Post ||--o{ Board : belongs_to
    Post {
        string title
        string content
        array boards          "çœ‹æ¿IDåˆ—è¡¨"
        array tags            "æ¨™ç±¤ï¼ˆç”¨æ–¼æœå°‹ï¼‰"
        object metadata
        array media
    }

    Board {
        string name          "çœ‹æ¿åç¨±"
        string slug          "URLå‹å¥½çš„åç¨±"
        string description   "çœ‹æ¿æè¿°"
        string icon          "çœ‹æ¿åœ–æ¨™"
        boolean isActive     "æ˜¯å¦å•Ÿç”¨"
        number sortOrder     "æ’åºé †åº"
        number postCount     "æ–‡ç« æ•¸é‡"
    }

    Tag {
        string name          "æ¨™ç±¤åç¨±"
        string category      "åˆ†é¡"
        number usageCount    "ä½¿ç”¨æ¬¡æ•¸"
    }
```

## æ–°å¢æª”æ¡ˆ

### 1. Board æ¨¡å‹ (`backend/models/Board.js`)

```javascript
const mongoose = require("mongoose");

const boardSchema = new mongoose.Schema(
  {
    name: {
      type: String,
      required: true,
      trim: true,
      maxlength: [50, "çœ‹æ¿åç¨±ä¸èƒ½è¶…é50å€‹å­—ç¬¦"],
    },
    slug: {
      type: String,
      required: true,
      unique: true,
      lowercase: true,
      trim: true,
    },
    description: {
      type: String,
      trim: true,
      maxlength: [200, "æè¿°ä¸èƒ½è¶…é200å€‹å­—ç¬¦"],
    },
    icon: {
      type: String,
      default: "ğŸ“",
    },
    color: {
      type: String,
      default: "#1976d2",
    },
    isActive: {
      type: Boolean,
      default: true,
    },
    sortOrder: {
      type: Number,
      default: 0,
    },
  },
  {
    timestamps: true,
  },
);

boardSchema.index({ sortOrder: 1, name: 1 });
boardSchema.index({ isActive: 1 });

module.exports = mongoose.model("Board", boardSchema);
```

### 2. çœ‹æ¿è·¯ç”± (`backend/routes/boards.js`)

- `GET /api/boards` - å–å¾—æ‰€æœ‰å•Ÿç”¨çš„çœ‹æ¿åˆ—è¡¨
- `GET /api/boards/:slug` - å–å¾—å–®å€‹çœ‹æ¿
- `POST /api/boards` - å»ºç«‹çœ‹æ¿ (admin)
- `PUT /api/boards/:id` - æ›´æ–°çœ‹æ¿ (admin)
- `DELETE /api/boards/:id` - åˆªé™¤çœ‹æ¿ (admin)
- `PUT /api/boards/:id/toggle` - å•Ÿç”¨/åœç”¨çœ‹æ¿ (admin)

### 3. æ¨™ç±¤è‡ªå‹•å®Œæˆ API (`backend/routes/tags.js`)

ç¾æœ‰è·¯ç”±éœ€æ“´å……ï¼š

- `GET /api/tags/search?q=xxx` - æ¨™ç±¤è‡ªå‹•å®Œæˆæœå°‹
- `GET /api/tags/popular` - å–å¾—ç†±é–€æ¨™ç±¤

## ä¿®æ”¹æª”æ¡ˆ

### 1. Post æ¨¡å‹ (`backend/models/Post.js`)

æ–°å¢ `boards` æ¬„ä½ï¼š

```javascript
boards: [
  {
    type: mongoose.Schema.Types.ObjectId,
    ref: "Board",
  },
],
```

ä¿®æ”¹ `tags` æ¬„ä½ï¼ˆç§»é™¤ autoGenerated å’Œ confidenceï¼‰ï¼š

```javascript
tags: [
  {
    tag: {
      type: String,
      trim: true,
    },
  },
],
```

### 2. æ–‡ç« è·¯ç”± (`backend/routes/posts.js`)

ä¿®æ”¹å…§å®¹ï¼š

1. å»ºç«‹æ–‡ç« æ™‚æ”¯æ´ `boards` æ¬„ä½
2. æŸ¥è©¢æ–‡ç« æ™‚æ”¯æ´ `board` éæ¿¾åƒæ•¸
3. ç§»é™¤ `generatePostTags` å’Œ `mergeWithManualTags` å‘¼å«
4. æ–°å¢ APIï¼šæŒ‰çœ‹æ¿å–å¾—æ–‡ç« åˆ—è¡¨

### 3. ç§»é™¤è‡ªå‹•æ¨™ç±¤ç›¸é—œæª”æ¡ˆ

å¾…ç§»é™¤ï¼š

- `backend/utils/post-tagging.js`
- `backend/utils/text-tagging.js`
- `backend/utils/vision-service.js` (å¦‚æœåªç”¨æ–¼æ¨™ç±¤)
- `backend/utils/vision-queue.js` (å¦‚æœåªç”¨æ–¼æ¨™ç±¤)

### 4. ç®¡ç†é é¢ (`frontend/src/pages/Admin.js`)

æ–°å¢çœ‹æ¿ç®¡ç†åŠŸèƒ½ï¼š

- æ–°å¢çœ‹æ¿
- ç·¨è¼¯çœ‹æ¿
- åœç”¨/å•Ÿç”¨çœ‹æ¿
- èª¿æ•´æ’åº

### 5. å»ºç«‹æ–‡ç« é é¢ (`frontend/src/pages/CreatePost.js`)

ä¿®æ”¹å…§å®¹ï¼š

1. æ–°å¢çœ‹æ¿é¸æ“‡å…ƒä»¶ï¼ˆå¤šé¸ï¼‰
2. æ¨™ç±¤è¼¸å…¥æ”¹ç‚ºæ”¯æ´è‡ªå‹•å®Œæˆ
3. ç§»é™¤è‡ªå‹•æ¨™ç±¤é¡¯ç¤ºå€å¡Š

### 6. ç·¨è¼¯æ–‡ç« é é¢ (`frontend/src/pages/EditPost.js`)

ä¿®æ”¹å…§å®¹ï¼š

1. æ–°å¢çœ‹æ¿é¸æ“‡å…ƒä»¶
2. æ¨™ç±¤è¼¸å…¥æ”¹ç‚ºæ”¯æ´è‡ªå‹•å®Œæˆ

### 7. é¦–é  (`frontend/src/pages/Home.js`)

ä¿®æ”¹å…§å®¹ï¼š

1. æ–°å¢çœ‹æ¿å°èˆªåˆ—
2. æŒ‰çœ‹æ¿åˆ†é¡é¡¯ç¤ºæ–‡ç« 
3. å¯åˆ‡æ›çœ‹æ¿æª¢è¦–

### 8. æ–‡ç« è©³æƒ…é é¢ (`frontend/src/pages/PostDetail.js`)

ä¿®æ”¹å…§å®¹ï¼š

1. é¡¯ç¤ºæ–‡ç« æ‰€å±¬çœ‹æ¿
2. æ¨™ç±¤é¡¯ç¤ºæ¨£å¼èª¿æ•´

### 9. Redux Slice (`frontend/src/slices/postsSlice.js`)

æ–°å¢ï¼š

- `fetchBoards` - å–å¾—çœ‹æ¿åˆ—è¡¨
- `fetchPostsByBoard` - æŒ‰çœ‹æ¿å–å¾—æ–‡ç« 

## é è¨­çœ‹æ¿è³‡æ–™

```javascript
const defaultBoards = [
  {
    name: "é­šé¡è¨è«–",
    slug: "fish",
    icon: "ğŸŸ",
    color: "#2196f3",
    description: "é—œæ–¼è§€è³é­šçš„è¨è«–",
  },
  {
    name: "è¦é¡è¨è«–",
    slug: "shrimp",
    icon: "ğŸ¦",
    color: "#ff9800",
    description: "é—œæ–¼è§€è³è¦çš„è¨è«–",
  },
  {
    name: "æ°´è‰å°ˆå€",
    slug: "plant",
    icon: "ğŸŒ¿",
    color: "#4caf50",
    description: "æ°´è‰ç¨®æ¤èˆ‡é€ æ™¯",
  },
  {
    name: "èºé¡è²é¡",
    slug: "snail",
    icon: "ğŸš",
    color: "#795548",
    description: "é—œæ–¼èºé¡å’Œè²é¡çš„è¨è«–",
  },
  {
    name: "è¨­å‚™å™¨æ",
    slug: "equipment",
    icon: "âš™ï¸",
    description: "éæ¿¾å™¨ã€ç‡ˆå…·ã€CO2è¨­å‚™ç­‰",
  },
  {
    name: "ç–¾ç—…å¥åº·",
    slug: "disease",
    icon: "ğŸ¥",
    description: "é­šé¡ç–¾ç—…æ²»ç™‚èˆ‡é é˜²",
  },
  {
    name: "ä¸€èˆ¬è¨è«–",
    slug: "general",
    icon: "ğŸ’¬",
    description: "å…¶ä»–æ°´æ—ç›¸é—œè©±é¡Œ",
  },
  {
    name: "äº¤æ˜“å°ˆå€",
    slug: "marketplace",
    icon: "ğŸ·ï¸",
    description: "ç‰©å“è²·è³£èˆ‡äº¤æ›",
  },
  {
    name: "ä½œå“åˆ†äº«",
    slug: "showcase",
    icon: "ğŸ–¼ï¸",
    description: "åˆ†äº«ä½ çš„æ°´æ—ç¼¸ç…§ç‰‡",
  },
];
```

## æ¨™ç±¤è‡ªå‹•å®ŒæˆåŠŸèƒ½

### å‰ç«¯å¯¦ä½œ

```javascript
// TagAutocomplete å…ƒä»¶
const TagAutocomplete = ({ value, onChange }) => {
  const [inputValue, setInputValue] = useState("");
  const [suggestions, setSuggestions] = useState([]);

  const handleInputChange = async (e) => {
    const value = e.target.value;
    setInputValue(value);

    if (value.length >= 2) {
      const response = await fetch(`/api/tags/search?q=${value}`);
      const data = await response.json();
      setSuggestions(data.data.tags);
    } else {
      setSuggestions([]);
    }
  };

  const handleSelect = (tag) => {
    onChange([...value, tag]);
    setInputValue("");
    setSuggestions([]);
  };

  return (
    <div>
      <input value={inputValue} onChange={handleInputChange} />
      {suggestions.length > 0 && (
        <ul className="suggestions">
          {suggestions.map((tag) => (
            <li key={tag.name} onClick={() => handleSelect(tag.name)}>
              {tag.name} ({tag.usageCount}æ¬¡ä½¿ç”¨)
            </li>
          ))}
        </ul>
      )}
    </div>
  );
};
```

## é·ç§»ç­–ç•¥

### æ­¥é©Ÿ 1ï¼šè³‡æ–™åº«é·ç§»

1. å»ºç«‹ Board collection ä¸¦æ’å…¥é è¨­è³‡æ–™
2. ç‚º Post æ–°å¢ boards æ¬„ä½
3. ä¿®æ”¹ tags æ¬„ä½çµæ§‹ï¼ˆç§»é™¤ confidence å’Œ autoGeneratedï¼‰

### æ­¥é©Ÿ 2ï¼šå¾Œç«¯æ›´æ–°

1. å»ºç«‹ Board æ¨¡å‹å’Œè·¯ç”±
2. ä¿®æ”¹ Post æ¨¡å‹
3. ä¿®æ”¹æ–‡ç« è·¯ç”±
4. æ“´å……æ¨™ç±¤æœå°‹ API
5. ç§»é™¤è‡ªå‹•æ¨™ç±¤ç›¸é—œç¨‹å¼ç¢¼

### æ­¥é©Ÿ 3ï¼šå‰ç«¯æ›´æ–°

1. æ–°å¢çœ‹æ¿ç®¡ç†é é¢
2. ä¿®æ”¹å»ºç«‹/ç·¨è¼¯æ–‡ç« é é¢
3. ä¿®æ”¹é¦–é å’Œæ–‡ç« è©³æƒ…é é¢
4. å¯¦ä½œæ¨™ç±¤è‡ªå‹•å®Œæˆå…ƒä»¶

## æ¸¬è©¦é …ç›®

- [ ] çœ‹æ¿ CRUD æ“ä½œ
- [ ] æ–‡ç« å‰µå»ºæ™‚é¸æ“‡å¤šå€‹çœ‹æ¿
- [ ] æŒ‰çœ‹æ¿ç¯©é¸æ–‡ç« 
- [ ] æ¨™ç±¤è‡ªå‹•å®ŒæˆåŠŸèƒ½
- [ ] æ¨™ç±¤æœå°‹åŠŸèƒ½
- [ ] é¦–é çœ‹æ¿å°èˆª
- [ ] ç®¡ç†å¾Œå°çœ‹æ¿ç®¡ç†

## ç›¸é—œæª”æ¡ˆæ¸…å–®

| æª”æ¡ˆ                                | å‹•ä½œ |
| ----------------------------------- | ---- |
| `backend/models/Board.js`           | æ–°å¢ |
| `backend/routes/boards.js`          | æ–°å¢ |
| `backend/models/Post.js`            | ä¿®æ”¹ |
| `backend/routes/posts.js`           | ä¿®æ”¹ |
| `backend/routes/tags.js`            | ä¿®æ”¹ |
| `backend/utils/post-tagging.js`     | ç§»é™¤ |
| `backend/utils/text-tagging.js`     | ç§»é™¤ |
| `frontend/src/pages/Admin.js`       | ä¿®æ”¹ |
| `frontend/src/pages/CreatePost.js`  | ä¿®æ”¹ |
| `frontend/src/pages/EditPost.js`    | ä¿®æ”¹ |
| `frontend/src/pages/Home.js`        | ä¿®æ”¹ |
| `frontend/src/pages/PostDetail.js`  | ä¿®æ”¹ |
| `frontend/src/slices/postsSlice.js` | ä¿®æ”¹ |
